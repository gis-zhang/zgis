<html>
<head>
	<title>地图api测试示例</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="../src/lib/leaflet-0.7.3/leaflet.css" />
	<link rel="stylesheet" href="../dist/zmap.css" />
	<link rel="stylesheet" href="../src/lib/leaflet-extend/control/L.TextIcon.js" />

	<script src="../src/lib/leaflet-0.7.3/leaflet-src.js"></script>
	<script src="../src/lib/threejs/three.js"></script>
	<script src="../src/lib/threejs/ConvexGeometry.js"></script>
	<script src="../src/lib/threebsp/ThreeBSP.js"></script>
	<script src="../src/lib/leaflet-extend/control/Util.js"></script>
	<script src="../src/lib/leaflet-extend/layer/L.CustomTileLayer.js"></script>
	<script src="../src/lib/leaflet-extend/layer/layer.wmts-src.js"></script>
	<script src="../src/lib/leaflet-extend/layer/layer.tdt-src.js"></script>
	<script src="../src/lib/leaflet-plugin/Leaflet.zoomslider-0.6.1/src/L.Control.Zoomslider.js"></script>
	<script src="../src/lib/leaflet-extend/crs/L.CRS.CustomLevel.js"></script>
	<script src="../src/lib/leaflet-extend/control/L.Control.Layers.Custom.js"></script>
	<script src="../src/lib/leaflet-plugin/MiniMap/Control.MiniMap.min.js"></script>
	<script src="../src/lib/leaflet-extend/MapConfig.js" charset="GBK"></script>
	<script src="../src/lib/leaflet-extend/control/L.TextIcon.js"></script>
	<script src="../src/lib/leaflet-extend/Map.js"></script>
	<script src="../dist/zmap-release.js"></script>
	<script src="http://localhost/mapapi/example/testdata_wkt3.js"></script>
	<script src="../src/zmap/fonts/gentilis_bold.typeface.js"></script>
	<script src="../src/zmap/fonts/gentilis_regular.typeface.js"></script>
	<script src="../src/zmap/fonts/optimer_bold.typeface.js"></script>
	<script src="../src/zmap/fonts/optimer_regular.typeface.js"></script>
	<script src="../src/zmap/fonts/helvetiker_bold.typeface.js"></script>
	<script src="../src/zmap/fonts/helvetiker_regular.typeface.js"></script>
	<script src="../src/zmap/fonts/droid/droid_sans_regular.typeface.js"></script>
	<script src="../src/zmap/fonts/droid/droid_sans_bold.typeface.js"></script>
	<script src="../src/zmap/fonts/droid/droid_serif_regular.typeface.js"></script>
	<script src="../src/zmap/fonts/droid/droid_serif_bold.typeface.js"></script>

	<script src="../src/lib/stats.min.js"></script>
	<script>
		var rotateX = 0, rotateY = 0; rotateZ = 0, map = null, sunH = 30, sunV = 45;

//		function mousemove(){alert("sdsfsfd");
//			console.log("map div: mousemove");
//		}

		function load(){
			//map = new ZMap('map', {sceneType: '3D', center:{x:120.293820214832, y:31.5801890000232}, initZoom: 18, maxZoom: 20});
			map = new ZMap('map', {sceneType: '3D', center:{x:117.01671, y:36.861610}, initZoom: 18, maxZoom: 20});
//            document.getElementById("map").onmousemove = function(){
//				console.log("map div: mousemove");
//			}
//			map.on("mouseup", function(e){alert("mouseup");});
//			map.on("moveend", function(e){alert("moveend");});
//			map.on("dragend", function(e){alert("dragend");});
//			map.on("viewreset", function(e){alert("viewreset1");});
//			map.on("move", function(e){
//				//var p = map.latLngToContainerPoint(new Z.LatLng(31.5801890000232,120.294820214832));
//				var p = map._scene._latLngToGLPoint(new Z.LatLng(31.5801890000232,120.294820214832));
//				var box = map._scene._viewableGLBounds;
//				document.getElementById("aaa").innerHTML = "x: " + p.x + ", y: " + p.y +
//						"| topRight:x: " + box.getTopRight().x + ", y: " + box.getTopRight().y  +
//						"| bottomLeft:x: " + box.getBottomLeft().x + ", y: " + box.getBottomLeft().y;
//			});
			//addNewObject();


//			document.getElementById("map").addEventListener( 'click', clickMap, false );
		}

		function showPopup(){
			map.openPopup("popup测试popup测试popup测试popup测试popup测试popup测试popup测试popup测试popup测试popup测试popup测试", new Z.LatLng(31.5801890000232,120.294820214832));
		}

		function x_add(){
			//rotateX += 5;
			rotateX = 2;
			rotateY = 0;
			rotateZ = 0;
			refresh();
		}

		function x_sub(){
//			rotateX -= 5;
			rotateX = -2;
			rotateY = 0;
			rotateZ = 0;
			refresh();
		}

		function y_add(){
//			rotateY += 5;
			rotateY = 5;
			rotateX = 0;
			rotateZ = 0;
			refresh();
		}

		function y_sub(){
//			rotateY -= 5;
			rotateY = -5;
			rotateX = 0;
			rotateZ = 0;
			refresh();
		}

		function z_add(){
			//rotateZ += 5;
			rotateZ = 5;
			rotateY = 0;
			rotateX = 0;
			refresh();
		}

		function z_sub(){
			//rotateZ -= 5;
			rotateZ = -5;
			rotateY = 0;
			rotateX = 0;
			refresh();
		}

		function x_pan_add(){
			map.panBy(10);
			showBbox();
		}

		function x_pan_sub(){
			map.panBy(-10);
			showBbox();
		}

		function y_pan_add(){
			//map._scene.translateByGL({x: 0, y:1, z:0});
			map.panBy(0, 50);
			showBbox();
		}

		function y_pan_sub(){
			//map._scene.translateByGL({x: 0, y:-1, z:0});
			map.panBy(0, -50);
			showBbox();
		}

//		function z_pan_add(){
//			//map._scene.translateByGL({x: 0, y:0, z:1});
//			//map.panBy(0, -50);
//			showBbox();
//		}
//
//		function z_pan_sub(){
//			//map._scene.translateByGL({x: 0, y:0, z:-1});
//			//map.panBy(0, -50);
//			showBbox();
//		}

		function sun_up(){
			sunV += 5;
			map.setSunLight({h: sunH, v:sunV});
		}

		function sun_down(){
			sunV -= 5;
			map.setSunLight({h: sunH, v:sunV});
		}

		function clickMap(event){
			var point = map.screenPointToLatLng(new Z.Point(event.clientX,event.clientY));
			alert(point.lat + "," + point.lng);
		}

		var spriteContainer;
		var i = 1;
		function refreshSprite(){
//			var mapRotate = map._scene.getRotateByRad();
//			spriteContainer.setRotationFromQuaternion(new THREE.Quaternion(mapRotate.x, mapRotate.y, mapRotate.z, mapRotate.w));
		}

		function refresh(){
			//map._scene.setRotationByEuler({x: rotateX, y:rotateY, z:rotateZ});
			map.rotateByEuler({x: rotateX, y:rotateY, z:rotateZ});
			//map._scene.render();

			refreshSprite();
			map._scene.refresh();
			//showBbox();
		}

		function showBbox(){
			var visibleBounds = map._scene._sceneRender.getVisibleGLBounds();
			var visibleLatLngBounds = map.getContentBounds();
			document.getElementById("aaa").innerHTML = "Left:x=" + visibleBounds.getBottomLeft().x + ";y=" + visibleBounds.getBottomLeft().y + ";z=" + visibleBounds.getBottomLeft().z +
					"。Right:x=" + visibleBounds.getTopRight().x + ";y=" + visibleBounds.getTopRight().y + ";z=" + visibleBounds.getTopRight().z;
			document.getElementById("bbb").innerHTML = "Left:x=" + visibleLatLngBounds.getWest() + ";y=" + visibleLatLngBounds.getSouth() + ";z=" + visibleLatLngBounds.getBottom() +
					"。Right:x=" + visibleLatLngBounds.getEast() + ";y=" + visibleLatLngBounds.getNorth() + ";z=" + visibleLatLngBounds.getTop();
		}

		function reset(){
			map._scene._sceneRender.resetCamera();
			map._scene._sceneRender.render();
		}
		function addNewObject(){
			var planeGeometry = new THREE.PlaneGeometry(30,20,5,5);
			//var planeMaterial = new THREE.MeshBasicMaterial({color: 0xcccc00, wireframe: true});
			var planeMaterial = new THREE.MeshLambertMaterial({color: 0xcccc00, shading: THREE.FlatShading});
//			var planeMaterial = new THREE.MeshPhongMaterial( {
//				shininess: 80,
//				color: 0xffffff,
//				specular: 0xffffff
//			} );
//			planeMaterial.polygonOffset = true;
//			planeMaterial.polygonOffsetFactor = 0;
//			planeMaterial.polygonOffsetUnits = 0;
			var plane = new THREE.Mesh(planeGeometry, planeMaterial);
//			plane.castShadow = true;
			plane.receiveShadow = true;
			plane.renderOrder = 8;
			//map._scene._sceneRender.addObject(plane);

			//var planeGeometry1 = new THREE.PlaneGeometry(20,10,5,5);
			var planeGeometry1 = new THREE.ShapeGeometry(new THREE.Shape([
				new THREE.Vector3( -10, 0, 0 ),
				new THREE.Vector3( 0, 10, 0 ),
				new THREE.Vector3( 10, 0, 0 )]));
			var planeMaterial1 = new THREE.MeshBasicMaterial({color: 0x00cccc, shading: THREE.FlatShading});
			var url = "http://localhost:8080/img_c/wmts?service=WMTS&request=GetTile&version=1.0.0&layer=img&style=default&tilematrixSet=c&format=tiles&tileMatrix=6&tileRow=9&tileCol=51";
			var texture = THREE.ImageUtils.loadTexture(url, {}, function(){
				map._scene.refresh();
			}, function(){
				map._scene.refresh();
			});
			texture.wrapS = THREE.RepeatWrapping;
			texture.wrapT = THREE.RepeatWrapping;
			planeMaterial1.map = texture;
//			planeMaterial1.polygonOffset = true;
//			planeMaterial1.polygonOffsetFactor = 0;
//			planeMaterial1.polygonOffsetUnits = 0;
			var plane1 = new THREE.Mesh(planeGeometry1, planeMaterial1);
//			plane.castShadow = true;
			plane1.receiveShadow = true;
			plane1.renderOrder = 9;
			//map._scene._sceneRender.addObject(plane1);


//			spriteContainer = new THREE.Object3D();
//			var spriteGeometry1 = new THREE.PlaneGeometry(20,20,5,5);
//			var spriteMaterial1 = new THREE.MeshBasicMaterial({color: 0x00cccc, shading: THREE.FlatShading});
//			var spriteUrl = "http://localhost:8080/zmap/src/zmap/image/marker-icon-2x.png";
//			var spriteTexture = THREE.ImageUtils.loadTexture(spriteUrl, {}, function(){
//				map._scene.refresh();
//			}, function(){
//				map._scene.refresh();
//			});
//			spriteTexture.wrapS = THREE.RepeatWrapping;
//			spriteTexture.wrapT = THREE.RepeatWrapping;
//			spriteMaterial1.map = spriteTexture;
//			var spriteObject = new THREE.Mesh(spriteGeometry1, spriteMaterial1);
//			spriteContainer.add(spriteObject);
//			spriteObject.translateY(10);
//			//spriteContainer = spriteObject;
//			spriteContainer.position.set(5,5,0);
//			map._scene._sceneRender.addObject(spriteContainer);

			var lineMaterial = new THREE.LineBasicMaterial({
				color: 0x0000ff,
				polygonOffset: true,
				polygonOffsetFactor: -3,
				polygonOffsetUnits: -3,
				transparent: true,
				opacity: 1,
				fog: true
			});

//			var lineGeometry = new THREE.Geometry();
//			lineGeometry.vertices.push(
//					new THREE.Vector3( -10, 0, 0 ),
//					new THREE.Vector3( 0, 10, 0 ),
//					new THREE.Vector3( 10, 0, 0 )
//			);
			var lineGeometry = new THREE.ShapeGeometry(new THREE.Shape([
				new THREE.Vector3( -10, 0, 0 ),
				new THREE.Vector3( 0, 10, 0 ),
				new THREE.Vector3( 10, 0, 0 )]));

			var line = new THREE.Line( lineGeometry, lineMaterial );
			line.renderOrder = 8;
			map._scene._sceneRender.addObject(line);

			var boxGeometry = new THREE.BoxGeometry(10,5,5);
			//boxGeometry.computeFaceNormals();
			//var boxMaterial = new THREE.MeshBasicMaterial({color: 0xcc0000, wireframe: true});
			//var boxMaterial = new THREE.MeshLambertMaterial({color: 0xcc0000, shading: THREE.FlatShading, overdraw: 0.5});
			//var boxMaterial = new THREE.MeshLambertMaterial({color: 0xcc0000});
			var boxMaterial = new THREE.MeshPhongMaterial( {color: 0xff00ff} );
			boxMaterial.polygonOffset = true;
			boxMaterial.polygonOffsetFactor = 1;
			boxMaterial.polygonOffsetUnits = 1;
			var box = new THREE.Mesh(boxGeometry, boxMaterial);
			box.position.z = 2;
			box.castShadow = true;
			//box.receiveShadow = true;
			map._scene._sceneRender.addObject(box);

			var axisHelper = new THREE.AxisHelper( 50 );
			map._scene._sceneRender.addObject( axisHelper );

			map._scene._sceneRender.render();

//			var orthoBounds = map._scene._sceneRender.getOrthoGLBounds();
//			alert("Left:x=" + orthoBounds.getBottomLeft().x + ";y=" + orthoBounds.getBottomLeft().y + ";z=" + orthoBounds.getBottomLeft().z +
//					"Right:x=" + orthoBounds.getTopRight().x + ";y=" + orthoBounds.getTopRight().y + ";z=" + orthoBounds.getTopRight().z);
//
//			var visibleBounds = map._scene._sceneRender.getVisibleGLBounds();
//			alert("Left:x=" + visibleBounds.getBottomLeft().x + ";y=" + visibleBounds.getBottomLeft().y + ";z=" + visibleBounds.getBottomLeft().z +
//					"Right:x=" + visibleBounds.getTopRight().x + ";y=" + visibleBounds.getTopRight().y + ";z=" + visibleBounds.getTopRight().z);
		}

		function zoomIn(){
			map.zoomIn();
		}

		function zoomOut(){
			map.zoomOut();
		}

		var added = false;
		var layer1 = new Z.TDTVectorLayer();
		var layer2 = new Z.TDTVectorAnnoLayer();
		var layer3 = new Z.TDTRasterLayer();
		var layer4 = new Z.TDTRasterAnnoLayer();
//		function addNewLayer(){
////			if(!added){
//				var layer = new Z.TDTVectorLayer();
//				map.addLayer(layer);
//				var layer1 = new Z.TDTVectorAnnoLayer();
//				map.addLayer(layer1,1);
//				added = true;
////			}
//		}

		function addVectorLayer(){
			map.addLayer(layer1, 0);
//			map.addLayer(layer1, 0, Z.LayerGroup.BaseBgLayer);
		}
		function addVectorAnnoLayer(){
			map.addLayer(layer2, 1);
		}
		function addRasterLayer(){
			//map.addLayer(layer3, 0, Z.LayerGroup.BaseOverLayer);
			map.addLayer(layer3, 2, Z.LayerGroup.BaseBgLayer);
		}
		function addRasterAnnoLayer(){
			map.addLayer(layer4, 3, Z.LayerGroup.BaseBgLayer);
			//map.addLayer(layer4, 1, Z.LayerGroup.BaseOverLayer);
			//map.addLayer(layer2, 3, Z.LayerGroup.BaseOverLayer);
		}
		function removeVectorLayer(){
			map.removeLayer(layer1);
		}
		function removeVectorAnnoLayer(){
			map.removeLayer(layer2);
		}
		function removeRasterLayer(){
			map.removeLayer(layer3);
		}
		function removeRasterAnnoLayer(){
			map.removeLayer(layer4);
		}

		var vectorLayer = null;

		function addPolyline(){
			var geom = new Z.Polyline([[[30,120], [30,121], [28, 110]], [[48,101], [29,100], [39,110]]]);
			var shape = new Z.Feature({id:'polyline_id112', name: 'polyline_name1234'}, geom);
			var symbol = new Z.PolylineSymbol({color:'#aaaa00', width:2});
			var graphic = new Z.Graphic(shape, symbol, {tip: "#{id}", title: "#{name}"});

			if(!vectorLayer){
				vectorLayer = new Z.TerrainGraphicLayer({enableTip: true});
				//map.addLayer(vectorLayer, 1, Z.LayerGroup.BaseOverLayer);
				map.addLayer(vectorLayer, 3);
			}
			map.setZoom(4);
			vectorLayer.addGraphic(graphic);

		}

		var polygonLayer = null;
//		function addPolygon(){
//			var geom = new Z.Polygon([[[35,93], [25,93], [25, 110], [35, 110], [35, 93]], [[32,100], [30,105], [28,100], [30, 95], [32,100]]]);
//			//var geom = new Z.Polygon([[[33,95], [27,95], [27, 105], [33, 105], [33, 95]], [[31,100], [30,102], [29,100], [30, 98], [31,100]]]);
//			//var geom = new Z.Polygon([[[33,95], [27,95], [27, 105], [33, 105], [33, 95]]]);
//			var shape = new Z.Feature({id:'polygon_id112', name: 'polygon_name1234'}, geom);
//			var symbol = new Z.PolygonSymbol({
//						polylineSymbol: new Z.PolylineSymbol({color:'#aa00aa', width:2, opacity: 0.7}),
//						fillSymbol: new Z.PictureFillSymbol({url:'http://localhost:8080/zmap/src/zmap/image/tree.jpg', opacity: 0.5}),
//					hideFill: false,
//					hidePolyline: true}
//			);
//			//var graphic = new Z.Graphic(shape, symbol, {tip: "321", title: "aaa"});
//			var graphic = new Z.Graphic(shape, symbol, {tip: "#{id}", title: "#{name}"});
//
//			if(!polygonLayer){
//				polygonLayer = new Z.TerrainGraphicLayer({enableTip: true, enableTitle: false});
//				map.addLayer(polygonLayer, 4);
//			}
//
//			polygonLayer.addGraphic(graphic);
//		}

		function addPolygon(){
			if(!polygonLayer){
				polygonLayer = new Z.TerrainGraphicLayer({enableTip: true, enableTitle: false});
				map.addLayer(polygonLayer, 4);
			}
			console.info("polygonCount:" + testWktData.length);
			var graphics = [];
			for(var i = 0; i < testWktData.length; i++){
				var coords = Z.WktParser.wkt2Array(testWktData[i].SHAPE),
						shapes = [];
				if(coords.type === "MultiPolygon"){
					shapes = coords.coords;
				}else if(coords.type === "Polygon"){
					shapes = [coords.coords];
				}

				var geom = new Z.Polygon(shapes);
				var shape = new Z.Feature(testWktData[i], geom);
				var symbol = new Z.PolygonSymbol({
							polylineSymbol: new Z.PolylineSymbol({color:'#aa00aa', width:2, opacity: 0.7}),
							//fillSymbol: new Z.PictureFillSymbol({url:'http://localhost:8080/zmap/src/zmap/image/tree.jpg', opacity: 0.5}),
							fillSymbol: new Z.SimpleFillSymbol({color:'#aaa00a', opacity: 0.5}),
							hideFill: false,
							hidePolyline: true}
				);
				//var graphic = new Z.Graphic(shape, symbol, {tip: "321", title: "aaa"});
				var graphic = new Z.Graphic(shape, symbol, {tip: "#{OBJECTID}", title: "#{OBJECTID}"});
				graphics.push(graphic);
//				polygonLayer.addGraphic(graphic);
			}

			polygonLayer.addGraphics(graphics);
		}

		var pictureLayer = null;
		function addPictureMarker(){
			var geom = new Z.LatLng(31.5801890000232,120.293820214832);//var geom = new Z.LatLng(32,103);
			var shape = new Z.Feature({id:'id112', name: 'name1234'}, geom);
			var symbol = new Z.PictureMarkerSymbol(
					{offset: new Z.Point(12, 21, 0), width:25, height:41,
					url: "http://localhost:8080/zmap/src/zmap/image/marker-icon.png"});
			//var symbol = new Z.PictureMarkerSymbol("http://localhost:8080/zmap/src/zmap/image/marker-icon.png");
			var graphic = new Z.Graphic(shape, symbol);

			if(!pictureLayer){
				pictureLayer = new Z.GraphicLayer();
				map.addLayer(pictureLayer, 3);
			}

			pictureLayer.addGraphic(graphic);
		}

		var pictureLayer_c;
		function addCircle(){
			var geom = new Z.Circle(null, new Z.LatLng(31.5801890000232,120.294820214832), 5, 'pixel');//var geom = new Z.LatLng(32,103);   {x:120.293820214832, y:31.5801890000232}
			var shape = new Z.Feature({id:'id112', name: 'name1234'}, geom);
			var symbol = new Z.CircleSymbol({hideBorder: false, fillSymbol: new Z.SimpleFillSymbol({opacity: 1, color:'#00ffff'})});
			//var symbol = new Z.PictureMarkerSymbol("http://localhost:8080/zmap/src/zmap/image/marker-icon.png");
			var graphic = new Z.Graphic(shape, symbol, {
				titleProp: 'name',
				titleSymbol: new Z.TextSymbol({
					fill: true,
					fillSymbol:{opacity: 0.5},
					border: true,
					borderSymbol:{opacity: 1, width: 2, color: '#000000', opacity: 0.6}
				})});

			if(!pictureLayer_c){
				pictureLayer_c = new Z.GraphicLayer({enableInfoWindow: true, enableTip: true});
				map.addLayer(pictureLayer_c, 2);
			}

			pictureLayer_c.addGraphic(graphic);
			graphic.showTitle();

			graphic.on("mouseover", function(e){
				document.getElementById("aaa").innerHTML = "mouse over";
			});

			graphic.on("mouseout", function(e){
				document.getElementById("aaa").innerHTML = "";
			});

//			pictureLayer_c.on("graphicmouseover", function(e){
//				alert("circle graphicmouseovered");
//			});

//			pictureLayer_c.on("graphicclick", function(e){
//				alert("circle graphicclicked");
//			});
//
//			pictureLayer_c.on("click", function(e){
//				alert("layer clicked");
//			});

//			var material = new THREE.MeshBasicMaterial({
//				color: 0x0000ff,
//				opacity:0.5
//			});
//
//			var radius = 5;
//			var segments = 32;
//
//			var circleGeometry = new THREE.CircleGeometry( radius, segments );
//			var circle = new THREE.Mesh( circleGeometry, material );
//			circle.position.z = 10;
//			material.transparent = true;
//			map._scene._sceneRender.addObject( circle );
//
//			map._scene._sceneRender.render();
		}

		var pictureLayer_r;
		function addRing() {
			var geom = new Z.Ring(null, new Z.LatLng(31.5801890000232, 120.293820214832), 20, 100);//var geom = new Z.LatLng(32,103);
			var shape = new Z.Feature({id: 'id112', name: 'name1234'}, geom);
			var symbol = new Z.RingSymbol({fillSymbol: new Z.SimpleFillSymbol({opacity: 0.99, color:'#ffff00'})});
			//var symbol = new Z.PictureMarkerSymbol("http://localhost:8080/zmap/src/zmap/image/marker-icon.png");
			var graphic = new Z.Graphic(shape, symbol);

			if (!pictureLayer_r) {
				pictureLayer_r = new Z.GraphicLayer();
//				map.addLayer(pictureLayer_r, 3);
				map.addLayer(pictureLayer_r, 1, Z.LayerGroup.BaseOverLayer);
			}

			pictureLayer_r.addGraphic(graphic);
		}

		var pictureLayer_t;
		function addTextMarker(){
			var geom = new Z.LatLng(31.5801890000232,120.293820214832,12);//new Z.LatLng(31.5801890000232,120.293820214832,12);
			var shape = new Z.Feature({id:'id112', name: 'name1234'}, geom);
			var symbol = new Z.TextSymbol({text:"百脑汇科技大厦Aaygh",
				font: {size: 20, style: Z.FontStyle.Italic, weight: Z.FontWeight.Bold}, color: '#ff0000', opacity: 0.99,
				fill: true, fillSymbol: {color: "#eeeeee", opacity: 0.7},
				border: false, borderSymbol: {color: '#ff0000'}});
			var selectedSymbol = new Z.TextSymbol({text:"百脑汇科技大厦",
				font: {size: 20, style: Z.FontStyle.Normal, weight: Z.FontWeight.Bold}, color: '#ffff00', opacity: 0.99,
				fill: true, fillSymbol: {color: "#eeeeee", opacity: 0.7},
				border: true, borderSymbol: {color: '#ff0000'}});
			//var symbol = new Z.PictureMarkerSymbol("http://localhost:8080/zmap/src/zmap/image/marker-icon.png");
			var graphic = new Z.Graphic(shape, symbol);

			if(!pictureLayer_t){
				pictureLayer_t = new Z.GraphicLayer();
				map.addLayer(pictureLayer_t, 2, Z.LayerGroup.BaseBgLayer);
//				map.addLayer(pictureLayer_t, 2);
			}

			pictureLayer_t.addGraphic(graphic);

			pictureLayer_t.on("click", function(e){console.info("layerEvent:" + e.type);
				if(e.objects.length > 0){
					if(e.objects[0] !== selectedGraphic){
						e.objects[0].graphic.updateSymbol(selectedSymbol);

						if(selectedGraphic){
							selectedGraphic.graphic.updateSymbol(symbol1);
						}

						selectedGraphic = e.objects[0].graphic;
						map.refresh();
					}
				}
			});
		}

		var graphic1;
		function addExtrude(){
//			var geom = new Z.Extrude(null,
//					[[[33,95], [27,95], [27, 105], [33, 105], [33, 95]], [[31,100], [30,102], [29,100], [30, 98], [31,100]]],
//					20
//			);
			var geom = new Z.Extrude(null,
					[[[30.1,99], [30,99], [30, 99.1], [30.1, 99.1]]],
					2000
			);
			var shape = new Z.Feature({id:'id112', name: 'name1234'}, geom);
			var symbol = new Z.ExtrudeSymbol({
				topColor:'#ff0000',
				wallColor:'#ffff00'
			});
			var graphic = new Z.Graphic(shape, symbol);

			var geom1 = new Z.Extrude(null,
					[[[30.15,99.05], [30.05,99.05], [30.05, 99.15], [30.15, 99.15]]],
					2000,
					2000
			);
			var shape1 = new Z.Feature({id:'id112', name: 'name1234'}, geom1);
			var symbol1 = new Z.ExtrudeSymbol({
				topColor:'#000fff',
				wallColor:'#ffaa33'
			});

			var selectedSymbol = new Z.ExtrudeSymbol({
				topColor:'#666666',
				wallColor:'#ff0000'
			});
//			var
					graphic1 = new Z.ComposeGraphic(shape1, symbol1);
			var selectedGraphic = null;
			graphic1.addMember(graphic);

//			var multiGraphic = new Z.ComposeGraphic({}, [graphic, graphic1]);
//
			if(!vectorLayer){
				vectorLayer = new Z.GraphicLayer();
				map.addLayer(vectorLayer, 2);
//
//				vectorLayer.on("mousedown", function(e){console.info("layerEvent:" + e.type);
//					if(e.objects.length > 0){
//						if(e.objects[0] !== selectedGraphic){
//							e.objects[0].graphic.updateSymbol(selectedSymbol);
//
//							if(selectedGraphic){
//								selectedGraphic.graphic.updateSymbol(symbol1);
//							}
//
//							selectedGraphic = e.objects[0].graphic;
//							map.refresh();
//						}
//					}
//				});
			}

			vectorLayer.addGraphic(graphic1);
//			vectorLayer.addGraphic(multiGraphic);
			map.panTo(new Z.LatLng(30.1, 99.1));
		}

		function showSubExtrude(){
			if(graphic1){
				graphic1.showMembers();
			}
		}

		function hideSubExtrude(){
			if(graphic1){
				graphic1.hideMembers();
			}
		}

		var buildingLayer;
		function loadBuildings(){
			var selectedSymbol = new Z.ExtrudeSymbol({
				topColor:'#0000ff',
				wallColor:'#dddddd'
			});

			var selectedGraphic = null, oldSymbol = null;

			//testWktData
			if(!buildingLayer){
				buildingLayer = new Z.BuildingLayer();
				map.addLayer(buildingLayer, 2);

//				buildingLayer.on("graphicclick", function(e){//console.info("layerEvent:" + e.type);
					buildingLayer.on("graphicmouseover", function(e){//console.info("layerEvent:" + e.type);
					if(e.objects.length > 0){
						if(e.objects[0].graphic !== selectedGraphic){//console.info(e.objects[0] !== selectedGraphic);
							if(!oldSymbol){
								oldSymbol = e.objects[0].symbol;
							}

//							e.objects[0].updateSymbol(selectedSymbol);

							if(selectedGraphic){
								selectedGraphic.updateSymbol(oldSymbol);
								selectedGraphic.hideTitle();
								//selectedGraphic.showSurface();
							}

							selectedGraphic = e.objects[0];
							selectedGraphic.showTitle();
//							selectedGraphic.showAllFloors();
						}
					}else{
						if(selectedGraphic){
							if(oldSymbol){
								selectedGraphic.updateSymbol(oldSymbol);
							}

							selectedGraphic.hideTitle();
							selectedGraphic = null;
						}

						//selectedGraphic = null;
					}
					map.refresh();
				});
			}

			buildingLayer.loadBuildingsByWKT(testWktData,{
				shape:'#{SHAPE}',
				//title:{prop:'OBJECTID', symbol: new Z.TextSymbol({text:"百脑汇科技大厦",font: {size: 1}, color: '#222222', fillColor: '#999999', borderColor: '#0000ff'})},
				title:'#{OBJECTID}',
//				height:{prop:'BUILDINGHEIGHT'},
//				baseHeight:{
//					fun: function(record){
//						return parseFloat(record['FLOORS_DOWN'] * 3);
//					}
//				},
//				height:{fun: function(record){
//						return parseFloat(record['FLOOR'] * 3);
//					}
//				},
				height:function(record){
						return parseFloat(record['FLOOR'] * 1);
					},
//				baseHeight:{
//					value:0
//				},
				baseHeight: 0,
//				floorCount: 6,   //fun: function(record){return parseFloat(record['FLOOR']);}
//				partsData: {value: [{index: 1, height: 3}, {index: 2, height: 3}]},    //fun: function(record){}
				partsData: {fun: function(data){
					var floorCount = data['FLOOR'],
							floors = [];

					for(var i = 0; i < floorCount; i++){
						floors.push({index: i + 1, height: 3});
					}

					return floors;
				}},
				partsOptions: {
					floorIndexProp: 'index',
					height: {prop: 'height'}
				},
				topColor:'#ff0000',
				wallColor:'#ffff00'
			});
		}
	</script>
</head>
<body onload="load()">
	<input type="button" value="addNewObject" onclick="addNewObject()">
	<input type="button" value="重置相机位置" onclick="reset()">
	<input type="button" value="旋转x+" onclick="x_add()">
	<input type="button" value="旋转x-" onclick="x_sub()">
	<input type="button" value="旋转y+" onclick="y_add()">
	<input type="button" value="旋转y-" onclick="y_sub()">
	<input type="button" value="旋转z+" onclick="z_add()">
	<input type="button" value="旋转z-" onclick="z_sub()">
	<input type="button" value="移动x+" onclick="x_pan_add()">
	<input type="button" value="移动x-" onclick="x_pan_sub()">
	<input type="button" value="移动y+" onclick="y_pan_add()">
	<input type="button" value="移动y-" onclick="y_pan_sub()">
	<!--<input type="button" value="移动z+" onclick="z_pan_add()">-->
	<!--<input type="button" value="移动z-" onclick="z_pan_sub()">-->
	<input type="button" value="太阳上升" onclick="sun_up()">
	<input type="button" value="太阳下落" onclick="sun_down()">
	<input type="button" value="放大" onclick="zoomIn()">
	<input type="button" value="缩小" onclick="zoomOut()">
	<br>
	<input type="button" value="添加天地图矢量底图" onclick="addVectorLayer()">
	<input type="button" value="添加天地图矢量注记" onclick="addVectorAnnoLayer()">
	<input type="button" value="添加天地图影像底图" onclick="addRasterLayer()">
	<input type="button" value="添加天地图影像注记" onclick="addRasterAnnoLayer()">
	<input type="button" value="移除天地图矢量底图" onclick="removeVectorLayer()">
	<input type="button" value="移除天地图矢量注记" onclick="removeVectorAnnoLayer()">
	<input type="button" value="移除天地图影像底图" onclick="removeRasterLayer()">
	<input type="button" value="移除天地图影像注记" onclick="removeRasterAnnoLayer()">
	<br>
	<input type="button" value="添加线" onclick="addPolyline()">
	<input type="button" value="添加面" onclick="addPolygon()">
	<input type="button" value="添加图片标注" onclick="addPictureMarker()">
	<input type="button" value="添加文字标注" onclick="addTextMarker()">
	<input type="button" value="添加圆形标注" onclick="addCircle()">
	<input type="button" value="添加环形标注" onclick="addRing()">
	<input type="button" value="添加Extrude" onclick="addExtrude()">
	<input type="button" value="显示子Extrude" onclick="showSubExtrude()">
	<input type="button" value="隐藏子Extrude" onclick="hideSubExtrude()">
	<input type="button" value="添加建筑物" onclick="loadBuildings()">
	<input type="button" value="popup" onclick="showPopup()">
	<div id="map" style="width: 1000px; height: 500px;"></div>
	<br><span id="aaa"></span>
	<!--<br><span id="bbb"></span><br>-->


</body>
</html>